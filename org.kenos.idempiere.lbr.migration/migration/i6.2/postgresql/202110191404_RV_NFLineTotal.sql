-- 19 de out de 2021 13:56:25 BRT
INSERT INTO AD_ViewColumn (AD_Client_ID,AD_Org_ID,AD_ViewColumn_ID,AD_ViewColumn_UU,Created,CreatedBy,EntityType,IsActive,Updated,UpdatedBy,AD_ViewComponent_ID,ColumnName,ColumnSQL,SeqNo) VALUES (0,0,1120704,'77941254-f0a5-4cd8-bcef-96ad7e49c924',TO_TIMESTAMP('2021-10-19 13:56:24','YYYY-MM-DD HH24:MI:SS'),100,'LBRA','Y',TO_TIMESTAMP('2021-10-19 13:56:24','YYYY-MM-DD HH24:MI:SS'),100,1120001,'LineNetAmt','ROUND(((COALESCE(nfl.LineTotalAmt,0)+COALESCE(icmsst_add.LBR_TaxAmt,0)+COALESCE(ipi.LBR_TaxAmt,0)+COALESCE(nfl.FreightAmt,0)+COALESCE(nfl.LBR_InsuranceAmt,0)+COALESCE(nfl.LBR_OtherChargesAmt,0))-COALESCE(nfl.DiscountAmt,0)),2)',1060)
;

-- 19 de out de 2021 13:58:10 BRT
UPDATE AD_ViewComponent SET FromClause='FROM LBR_NotaFiscalline nfl
LEFT JOIN LBR_NotaFiscal nf ON (nfl.LBR_NotaFiscal_ID=nf.LBR_NotaFiscal_ID)
LEFT JOIN LBR_NFLineTax_V icms ON (nfl.LBR_NotaFiscalLine_ID=icms.LBR_NotaFiscalLine_ID AND icms.TaxIndicator=''ICMS'')
LEFT JOIN LBR_NFLineTax_V pis ON (nfl.LBR_NotaFiscalLine_ID=pis.LBR_NotaFiscalLine_ID AND pis.TaxIndicator=''PIS'')
LEFT JOIN LBR_NFLineTax_V cofins ON (nfl.LBR_NotaFiscalLine_ID=cofins.LBR_NotaFiscalLine_ID AND cofins.TaxIndicator=''COFINS'')
LEFT JOIN LBR_NFLineTax_V ipi ON (nfl.LBR_NotaFiscalLine_ID=ipi.LBR_NotaFiscalLine_ID AND ipi.TaxIndicator=''IPI'')
LEFT JOIN LBR_NFLineTax_V icmsst ON (nfl.LBR_NotaFiscalLine_ID=icmsst.LBR_NotaFiscalLine_ID AND icmsst.TaxIndicator=''ICMSST'')
LEFT JOIN LBR_NFLineTax_V icmsst_add ON (nfl.LBR_NotaFiscalLine_ID=icmsst_add.LBR_NotaFiscalLine_ID AND icmsst_add.TaxIndicator=''ICMSST'' AND icmsst_add.cst IN (''10'', ''30'', ''70'', ''90'', ''201'', ''202'', ''900''))
LEFT JOIN LBR_NFLineTax_V difal ON (nfl.LBR_NotaFiscalLine_ID=difal.LBR_NotaFiscalLine_ID AND difal.TaxIndicator=''ICMSDIFAL'')
LEFT JOIN LBR_NFLineTax_V difalo ON (nfl.LBR_NotaFiscalLine_ID=difalo.LBR_NotaFiscalLine_ID AND difalo.TaxIndicator=''ICMSDIFALORIG'')
LEFT JOIN LBR_NFLineTax_V fcp ON (nfl.LBR_NotaFiscalLine_ID=fcp.LBR_NotaFiscalLine_ID AND fcp.TaxIndicator=''FCP'')',Updated=TO_TIMESTAMP('2021-10-19 13:58:10','YYYY-MM-DD HH24:MI:SS'),UpdatedBy=100 WHERE AD_ViewComponent_ID=1120001
;

-- 19 de out de 2021 13:58:21 BRT
DROP VIEW RV_LBR_NotaFiscal_Details
;

-- 19 de out de 2021 13:58:21 BRT
CREATE OR REPLACE VIEW RV_LBR_NotaFiscal_Details(LBR_NotaFiscal_ID, AD_Client_ID, AD_Org_ID, IsActive, Created, CreatedBy, Updated, UpdatedBy, DocumentNo, C_BPartner_ID, C_DocTypeTarget_ID, C_Invoice_ID, C_InvoiceLine_ID, C_Order_ID, C_UOM_ID, COFINS_TaxAmt, COFINS_TaxBase, COFINS_TaxBaseAmt, COFINS_TaxRate, LBR_CSTCOFINS, LBR_CSTICMS, LBR_CSTIPI, LBR_CSTPIS, DateDoc, DateTrx, Description, Discount, DiscountAmt, DocStatus, FCP_TaxAmt, FCP_TaxBase, FCP_TaxBaseAmt, FCP_TaxRate, FCP_TaxStatus, FreightAmt, GrossRAmt, ICMS_TaxAmt, ICMS_TaxBase, ICMS_TaxBaseAmt, ICMS_TaxRate, DIFAL_TaxAmt, DIFAL_TaxBase, DIFAL_TaxBaseAmt, DIFAL_TaxRate, DIFAL_TaxStatus, DIFALO_TaxAmt, DIFALO_TaxBase, DIFALO_TaxBaseAmt, DIFALO_TaxRate, DIFALO_TaxStatus, ICMSST_TaxAmt, ICMSST_TaxBase, ICMSST_TaxBaseAmt, ICMSST_TaxRate, ICMSST_TaxStatus, IPI_TaxAmt, IPI_TaxBase, IPI_TaxBaseAmt, IPI_TaxRate, IsCancelled, LBR_CEST_ID, LBR_CFOP_ID, LBR_CFOPNote, LBR_FCIValue, LBR_FinNFe, LBR_IndTot, LBR_InsuranceAmt, LBR_IsOwnDocument, LBR_IsService, LBR_LineTotalCIF, LBR_LineTotalSISCOMEX, LBR_NCM_ID, LBR_NFDI_ID, LBR_NFeEnv, LBR_NFeID, LBR_NFeStatus, LBR_NotaFiscalLine_ID, LBR_NumAdicao, LBR_NumSeqItem, LBR_OtherChargesAmt, LBR_ProductSource, LBR_ServiceTaxes, LBR_TaxStatus, LBR_TaxStatusIPI, LBR_TransactionType, LBR_UOMName, Line, LineTotalAmt, M_InOut_ID , M_Product_ID, Manufacturer, PIS_TaxAmt, PIS_TaxBase, PIS_TaxBaseAmt, PIS_TaxRate, Price, PriceListAmt, ProductName, ProductValue, Qty, VendorProductNo, lbr_BPDeliveryRegion, lbr_NFENo, DateAcct, LBR_IsHomolog, LineNetAmt) AS SELECT nf.LBR_NotaFiscal_ID AS LBR_NotaFiscal_ID, nf.AD_Client_ID AS AD_Client_ID, nf.AD_Org_ID AS AD_Org_ID, nfl.IsActive AS IsActive, nfl.Created AS Created, nfl.CreatedBy AS CreatedBy, nfl.Updated AS Updated, nfl.UpdatedBy AS UpdatedBy, nf.DocumentNo AS DocumentNo, nf.C_BPartner_ID AS C_BPartner_ID, nf.C_DocTypeTarget_ID AS C_DocTypeTarget_ID, nf.C_Invoice_ID AS C_Invoice_ID, nfl.C_InvoiceLine_ID AS C_InvoiceLine_ID, nf.C_Order_ID AS C_Order_ID, nfl.C_UOM_ID AS C_UOM_ID, cofins.LBR_TaxAmt AS COFINS_TaxAmt, cofins.LBR_TaxBase AS COFINS_TaxBase, cofins.LBR_TaxBaseAmt AS COFINS_TaxBaseAmt, cofins.LBR_TaxRate AS COFINS_TaxRate, cofins.CST AS LBR_CSTCOFINS, icms.CST AS LBR_CSTICMS, ipi.CST AS LBR_CSTIPI, pis.CST AS LBR_CSTPIS, nf.DateDoc AS DateDoc, nf.DateTrx AS DateTrx, nfl.Description AS Description, nfl.Discount AS Discount, nfl.DiscountAmt AS DiscountAmt, nf.DocStatus AS DocStatus, fcp.LBR_TaxAmt AS FCP_TaxAmt, fcp.LBR_TaxBase AS FCP_TaxBase, fcp.LBR_TaxBaseAmt AS FCP_TaxBaseAmt, fcp.LBR_TaxRate AS FCP_TaxRate, fcp.CST AS FCP_TaxStatus, nfl.FreightAmt AS FreightAmt, ROUND(((nfl.LineTotalAmt+COALESCE(icmsst.LBR_TaxAmt,0))+COALESCE(ipi.LBR_TaxAmt,0)),2) AS GrossRAmt, icms.LBR_TaxAmt AS ICMS_TaxAmt, icms.LBR_TaxBase AS ICMS_TaxBase, icms.LBR_TaxBaseAmt AS ICMS_TaxBaseAmt, icms.LBR_TaxRate AS ICMS_TaxRate, difal.LBR_TaxAmt AS DIFAL_TaxAmt, difal.LBR_TaxBase AS DIFAL_TaxBase, difal.LBR_TaxBaseAmt AS DIFAL_TaxBaseAmt, difal.LBR_TaxRate AS DIFAL_TaxRate, difal.CST AS DIFAL_TaxStatus, difalo.LBR_TaxAmt AS DIFALO_TaxAmt, difalo.LBR_TaxBase AS DIFALO_TaxBase, difalo.LBR_TaxBaseAmt AS DIFALO_TaxBaseAmt, difalo.LBR_TaxRate AS DIFALO_TaxRate, difalo.CST AS DIFALO_TaxStatus, icmsst.LBR_TaxAmt AS ICMSST_TaxAmt, icmsst.LBR_TaxBase AS ICMSST_TaxBase, icmsst.LBR_TaxBaseAmt AS ICMSST_TaxBaseAmt, icmsst.LBR_TaxRate AS ICMSST_TaxRate, icmsst.CST AS ICMSST_TaxStatus, ipi.LBR_TaxAmt AS IPI_TaxAmt, ipi.LBR_TaxBase AS IPI_TaxBase, ipi.LBR_TaxBaseAmt AS IPI_TaxBaseAmt, ipi.LBR_TaxRate AS IPI_TaxRate, nf.IsCancelled AS IsCancelled, nfl.LBR_CEST_ID AS LBR_CEST_ID, nfl.LBR_CFOP_ID AS LBR_CFOP_ID, nf.LBR_CFOPNote AS LBR_CFOPNote, nfl.LBR_FCIValue AS LBR_FCIValue, nf.LBR_FinNFe AS LBR_FinNFe, nfl.LBR_IndTot AS LBR_IndTot, nfl.LBR_InsuranceAmt AS LBR_InsuranceAmt, nf.LBR_IsOwnDocument AS LBR_IsOwnDocument, nfl.LBR_IsService AS LBR_IsService, nfl.LBR_LineTotalCIF AS LBR_LineTotalCIF, nfl.LBR_LineTotalSISCOMEX AS LBR_LineTotalSISCOMEX, nfl.LBR_NCM_ID AS LBR_NCM_ID, nfl.LBR_NFDI_ID AS LBR_NFDI_ID, nf.LBR_NFeEnv AS LBR_NFeEnv, nf.LBR_NFeID AS LBR_NFeID, nf.LBR_NFeStatus AS LBR_NFeStatus, nfl.LBR_NotaFiscalLine_ID AS LBR_NotaFiscalLine_ID, nfl.LBR_NumAdicao AS LBR_NumAdicao, nfl.LBR_NumSeqItem AS LBR_NumSeqItem, nfl.LBR_OtherChargesAmt AS LBR_OtherChargesAmt, nfl.LBR_ProductSource AS LBR_ProductSource, nfl.LBR_ServiceTaxes AS LBR_ServiceTaxes, nfl.LBR_TaxStatus AS LBR_TaxStatus, nfl.LBR_TaxStatusIPI AS LBR_TaxStatusIPI, nf.LBR_TransactionType AS LBR_TransactionType, nfl.LBR_UOMName AS LBR_UOMName, nfl.Line AS Line, nfl.LineTotalAmt AS LineTotalAmt, nf.M_InOut_ID AS M_InOut_ID , nfl.M_Product_ID AS M_Product_ID, nfl.Manufacturer AS Manufacturer, pis.LBR_TaxAmt AS PIS_TaxAmt, pis.LBR_TaxBase AS PIS_TaxBase, pis.LBR_TaxBaseAmt AS PIS_TaxBaseAmt, pis.LBR_TaxRate AS PIS_TaxRate, nfl.Price AS Price, nfl.PriceListAmt AS PriceListAmt, nfl.ProductName AS ProductName, nfl.ProductValue AS ProductValue, nfl.Qty AS Qty, nfl.VendorProductNo AS VendorProductNo, nf.lbr_BPDeliveryRegion AS lbr_BPDeliveryRegion, CAST(COALESCE(nf.lbr_nfeno, nf.documentno) AS varchar(30)) AS lbr_NFENo, nf.DateAcct AS DateAcct, (CASE WHEN nf.LBR_NFeEnv='2' THEN 'Y' ELSE 'N' END) AS LBR_IsHomolog, ROUND(((COALESCE(nfl.LineTotalAmt,0)+COALESCE(icmsst_add.LBR_TaxAmt,0)+COALESCE(ipi.LBR_TaxAmt,0)+COALESCE(nfl.FreightAmt,0)+COALESCE(nfl.LBR_InsuranceAmt,0)+COALESCE(nfl.LBR_OtherChargesAmt,0))-COALESCE(nfl.DiscountAmt,0)),2) AS LineNetAmt FROM LBR_NotaFiscalline nfl LEFT JOIN LBR_NotaFiscal nf ON (nfl.LBR_NotaFiscal_ID=nf.LBR_NotaFiscal_ID) LEFT JOIN LBR_NFLineTax_V icms ON (nfl.LBR_NotaFiscalLine_ID=icms.LBR_NotaFiscalLine_ID AND icms.TaxIndicator='ICMS') LEFT JOIN LBR_NFLineTax_V pis ON (nfl.LBR_NotaFiscalLine_ID=pis.LBR_NotaFiscalLine_ID AND pis.TaxIndicator='PIS') LEFT JOIN LBR_NFLineTax_V cofins ON (nfl.LBR_NotaFiscalLine_ID=cofins.LBR_NotaFiscalLine_ID AND cofins.TaxIndicator='COFINS') LEFT JOIN LBR_NFLineTax_V ipi ON (nfl.LBR_NotaFiscalLine_ID=ipi.LBR_NotaFiscalLine_ID AND ipi.TaxIndicator='IPI') LEFT JOIN LBR_NFLineTax_V icmsst ON (nfl.LBR_NotaFiscalLine_ID=icmsst.LBR_NotaFiscalLine_ID AND icmsst.TaxIndicator='ICMSST') LEFT JOIN LBR_NFLineTax_V icmsst_add ON (nfl.LBR_NotaFiscalLine_ID=icmsst_add.LBR_NotaFiscalLine_ID AND icmsst_add.TaxIndicator='ICMSST' AND icmsst_add.cst IN ('10', '30', '70', '90', '201', '202', '900')) LEFT JOIN LBR_NFLineTax_V difal ON (nfl.LBR_NotaFiscalLine_ID=difal.LBR_NotaFiscalLine_ID AND difal.TaxIndicator='ICMSDIFAL') LEFT JOIN LBR_NFLineTax_V difalo ON (nfl.LBR_NotaFiscalLine_ID=difalo.LBR_NotaFiscalLine_ID AND difalo.TaxIndicator='ICMSDIFALORIG') LEFT JOIN LBR_NFLineTax_V fcp ON (nfl.LBR_NotaFiscalLine_ID=fcp.LBR_NotaFiscalLine_ID AND fcp.TaxIndicator='FCP')
;

-- 19 de out de 2021 13:58:30 BRT
INSERT INTO AD_Column (AD_Column_ID,Version,Name,Description,Help,AD_Table_ID,ColumnName,FieldLength,IsKey,IsParent,IsMandatory,IsTranslated,IsIdentifier,IsEncrypted,AD_Reference_ID,AD_Client_ID,AD_Org_ID,IsActive,Created,CreatedBy,Updated,UpdatedBy,AD_Element_ID,IsUpdateable,IsSelectionColumn,EntityType,IsAlwaysUpdateable,AD_Column_UU,IsToolbarButton) VALUES (1133752,0.0,'Line Amount','Line Extended Amount (Quantity * Actual Price) without Freight and Charges','Indicates the extended line amount based on the quantity and the actual price.  Any additional charges or freight are not included.  The Amount may or may not include tax.  If the price list is inclusive tax, the line amount is the same as the line total.',1120566,'LineNetAmt',131089,'N','N','N','N','N','N',12,0,0,'Y',TO_TIMESTAMP('2021-10-19 13:58:29','YYYY-MM-DD HH24:MI:SS'),100,TO_TIMESTAMP('2021-10-19 13:58:29','YYYY-MM-DD HH24:MI:SS'),100,441,'N','N','LBRA','N','ce9c2921-a69f-45ca-a760-ba5261474a16','N')
;

-- 19 de out de 2021 13:58:30 BRT
SELECT Register_Migration_Script ('202110191404_RV_NFLineTotal.sql') FROM DUAL
;

